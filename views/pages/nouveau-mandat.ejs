<%- include('includes/header.ejs') %>

    <body>
        <div class="layout">

            <div class="layout-header">
                <h1 class="header-title">Nouveau mandat</h1>
            </div>
            <%- include('includes/navbar.ejs') %>

                <div class="layout-content">
                    <form class="form-flex" onsubmit="addMandat(event)" method="post">
                        <div class="form-group">
                            <label for="label" class="form-label">Label</label>
                            <input id="label" type="text" class="form-input"
                                placeholder="Réponse">
                        </div>
                        <div class="form-group">
                            <label for="nom" class="form-label">Nom</label>
                            <input type="text" id="nom" class="form-input" placeholder="Réponse">
                        </div>
                        <div class="form-group">
                            <label for="categorie" class="form-label">Catégorie</label>
                            <select name="categorie" id="categorie" class="form-select">
                                <option value="null">Choisir une catégorie</option>
                                <option value="artisanat">Artisanat</option>
                                <option value="efj">EFJ</option>
                                <option value="eni">ENI</option>
                                <option value="ouverture-regionale">Ouverture-regionale</option>
                                <option value="pe-at">PE-AT</option>
                                <option value="social">Social</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="mission" class="form-label">Mission</label>
                            <input type="text" id="mission" class="form-input" placeholder="Réponse">
                        </div>
                        <div class="form-group">
                            <label for="composition" class="form-label">Composition</label>
                            <input type="text" id="composition" class="form-input" placeholder="Réponse">
                        </div>
                        <div class="form-group">
                            <label for="renouvellement" class="form-label">Renouvellement</label>
                            <input type="text" id="renouvellement" class="form-input" placeholder="Réponse">
                        </div>
                        <div class="form-group">
                            <label for="duree" class="form-label">Durée</label>
                            <input type="text" id="duree" class="form-input" placeholder="Réponse">
                        </div>
                        <div class="form-action">
                            <input type="submit" class="cta" value="Confirmer la création">
                        </div>
                    </form>
                </div>
        </div>
    </body>
    <script>
        function addMandat(event) {
            event.preventDefault();
            let mandat = {
                label: document.getElementById('label').value,
                nom: document.getElementById('nom').value,
                categorie: document.getElementById('categorie').value,
                mission: document.getElementById('mission').value,
                composition: document.getElementById('composition').value,
                duree: document.getElementById('duree').value,
                renouvellement: document.getElementById('renouvellement').value,
            }
            fetch(`http://localhost:7070/api/mandats/`, {
                method: "POST",
                headers: {
                    'Content-type': 'application/json'
                },
                body: JSON.stringify(mandat)
            })
                .then(res => {
                    console.log("Mandat ajouté : ", res);
                    alert('Mandat ajouté, vous allez être redirigé vers la liste des mandats')
                    document.location.assign(`/mandats`)
                });
        }

        function generateCode() {
            let field = document.getElementById('identifiant');
            let result = ''
            var characters = 'ABCDEFGHIJKLMNPQRSTUVWXYZ0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            field.value = result;
        }
    </script>
    <script src="/js/index.js"></script>

    </html>